# 深色/浅色模式切换功能实现计划

## 概述

为 LLM Trace Viewer 添加深色/浅色模式切换功能。利用现有的 CSS 变量架构，实现最小化改动。

## 实现步骤

### 1. 创建 Theme Hook

**新建文件:** `viewer/src/hooks/useTheme.ts`

- 创建 ThemeContext 和 useTheme hook
- 支持 localStorage 持久化用户偏好
- 默认跟随系统偏好 (prefers-color-scheme)
- 通过 `data-theme` 属性切换主题

### 2. 创建 ThemeProvider 组件

**新建文件:** `viewer/src/components/ThemeProvider.tsx`

- 包装 ThemeContext.Provider
- 在 main.tsx 中包裹整个应用

### 3. 添加浅色主题 CSS 变量

**修改文件:** `viewer/src/index.css`

在 `@theme` 块后添加浅色主题覆盖：

```css
[data-theme="light"] {
  --color-bg-primary: #ffffff;
  --color-bg-secondary: #f6f8fa;
  --color-bg-tertiary: #eaeef2;
  --color-bg-elevated: #ffffff;
  --color-border-default: #d0d7de;
  --color-border-muted: #eaeef2;
  --color-border-accent: #0969da;
  --color-text-primary: #1f2328;
  --color-text-secondary: #656d76;
  --color-text-muted: #8c959f;
  --color-role-system: #6e7781;
  --color-role-user: #0969da;
  --color-role-assistant: #1a7f37;
  --color-role-tool-use: #8250df;
  --color-role-tool-result: #9a6700;
  --color-success: #1a7f37;
  --color-warning: #9a6700;
  --color-error: #cf222e;
}
```

### 4. 创建切换按钮组件

**新建文件:** `viewer/src/components/ThemeToggle.tsx`

- 太阳/月亮图标切换
- 使用现有的 Tailwind 样式类

### 5. 更新入口文件

**修改文件:** `viewer/src/main.tsx`

- 导入并包裹 ThemeProvider

### 6. 添加切换按钮到界面

**修改文件:** `viewer/src/components/detail/RequestHeader.tsx`

- 在 duration 徽章左侧添加 ThemeToggle 按钮

### 7. 防止主题闪烁

**修改文件:** `viewer/index.html`

在 `<head>` 中添加内联脚本，在页面加载前设置 data-theme：

```html
<script>
  (function() {
    const stored = localStorage.getItem('llm-trace-theme');
    const theme = stored || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
    document.documentElement.setAttribute('data-theme', theme);
  })();
</script>
```

## 文件变更清单

| 文件 | 操作 |
|------|------|
| `viewer/src/hooks/useTheme.ts` | 新建 |
| `viewer/src/components/ThemeProvider.tsx` | 新建 |
| `viewer/src/components/ThemeToggle.tsx` | 新建 |
| `viewer/src/index.css` | 修改 - 添加浅色主题变量 |
| `viewer/src/main.tsx` | 修改 - 添加 ThemeProvider |
| `viewer/src/components/detail/RequestHeader.tsx` | 修改 - 添加切换按钮 |
| `viewer/index.html` | 修改 - 添加防闪烁脚本 |

## 验证步骤

1. 启动开发服务器: `cd viewer && npm run dev`
2. 验证默认跟随系统偏好
3. 点击切换按钮，确认主题正确切换
4. 刷新页面，确认偏好已持久化且无闪烁
5. 检查所有组件在两种主题下的显示效果
